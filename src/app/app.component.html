<nz-layout class="root-layout">
  <header>
    @if (vm$ | async; as vm) {
      <div class="brand">
        <a routerLink="/">Iswavle</a>
        <div class="search">
          @if (vm.indexMap) {
            <button
              nz-button
              nzType="text"
              nzShape="circle"
              (click)="isSearchModalVisible$.next(true)"
            >
              <span nz-icon nzType="search"></span>
            </button>
          }
        </div>
        <nz-modal
          nzTitle="ძებნა"
          [nzStyle]="{ top: '64px' }"
          [nzCancelText]="null"
          [nzOkText]="null"
          [nzFooter]="null"
          [(nzVisible)]="vm.isSearchModalVisible"
          (nzOnCancel)="
            isSearchModalVisible$.next(false); searchService.search$.next('')
          "
        >
          <ng-container *nzModalContent>
            <div class="search">
              <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
                <input
                  #input
                  nz-input
                  type="text"
                  placeholder="შეიყვანეთ საძიებო ტექსტი"
                  (keyup)="searchUp($event)"
                />
              </nz-input-group>
              <ng-template #suffixIconButton>
                <button
                  nz-button
                  nzSearch
                  nzType="primary"
                  (click)="clearSearch(input)"
                >
                  <span nz-icon nzType="clear" nzTheme="outline"></span>
                </button>
              </ng-template>
            </div>
            @if (vm.search) {
              <sw-search-result
                [indexMap]="vm.indexMap"
                [searchValue]="vm.search"
                (onResultClick)="
                  isSearchModalVisible$.next(false);
                  searchService.search$.next('')
                "
              ></sw-search-result>
            }
          </ng-container>
        </nz-modal>
      </div>
      <nav>
        <ul
          nz-menu
          [nzMode]="vm.menuMode || 'horizontal'"
          [class.is-open]="vm.isMenuOpen"
        >
          @for (nav of vm.headerNavigation; track nav.routerLink) {
            <li
              nz-menu-item
              [nzMatchRouter]="$index === 0"
              [nzMatchRouterExact]="$index === 0"
              [nzSelected]="nav.isActive"
            >
              <a
                [routerLink]="nav.routerLink"
                (click)="isMenuOpenedByUser$.next(false)"
              >
                {{ nav.title }}</a
              >
            </li>
          }
          <li nz-menu-item class="without-border">
            <div class="grouped">
              <a href="https://github.com/educata/iswavle" target="_blank">
                <span nz-icon nzType="github" nzTheme="outline"></span>
              </a>
              <button
                nz-button
                nz-dropdown
                nzType="text"
                nzPlacement="bottomRight"
                aria-label="დიზაინის ფერის შეცვლა"
                [nzDropdownMenu]="themeMenu"
              >
                <span nz-icon nzType="bg-colors" nzTheme="outline"></span>
              </button>
              <nz-dropdown-menu #themeMenu="nzDropdownMenu">
                <ul nz-menu>
                  <li nz-menu-item (click)="changeTheme(theme.Light)">
                    {{ theme.Light | titlecase }}
                  </li>
                  <li nz-menu-item (click)="changeTheme(theme.Dark)">
                    {{ theme.Dark | titlecase }}
                  </li>
                </ul>
              </nz-dropdown-menu>
            </div>
          </li>
        </ul>
        <button
          nz-button
          class="burger"
          aria-label="გამოაჩინე სანავიგაციო ველი"
          [attr.aria-expanded]="vm.isMenuOpen"
          (click)="
            this.isMenuOpenedByUser$.next(!this.isMenuOpenedByUser$.value)
          "
        >
          <span
            nz-icon
            [nzType]="vm.isMenuOpen ? 'close' : 'menu'"
            [attr.aria-label]="
              vm.isMenuOpen ? 'მენიუს გახსნა' : 'მენიუს დახურვა'
            "
          ></span>
        </button>
      </nav>
    }
  </header>
  <nz-layout>
    <router-outlet></router-outlet>
  </nz-layout>
</nz-layout>
